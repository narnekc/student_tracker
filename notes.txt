# üìã COMPREHENSIVE PROJECT PLAN FOR TIMETRACKER BACKEND


## üéØ PROJECT OVERVIEW

**System Purpose:** Student attendance tracking with check-in/check-out functionality, separate portals for students and managers, real-time reporting, and audit logging.

**Tech Stack:**
- **Backend:** Node.js + Express.js
- **Database:** SQLite (sql.js for pure JavaScript implementation)
- **Authentication:** JWT (JSON Web Tokens)
- **Security:** bcrypt for password hashing, helmet for HTTP headers
- **Validation:** express-validator

---

## üìä PHASE 1: DATABASE DESIGN & ARCHITECTURE

### **1.1 Database Tables (Based on UI Analysis)**

#### **Users Table**
- Stores both students and managers
- Fields: id, student_id (unique), first_name, last_name, email, password_hash, role (student/manager), status (active/inactive), department, created_at, updated_at, last_active
- Purpose: Authentication and user management

#### **Attendance Table**
- Tracks all check-in/check-out sessions
- Fields: id, user_id, check_in_time, check_out_time, total_hours, status (active/completed/auto_checkout), session_date, notes, created_at, updated_at
- Purpose: Core attendance tracking functionality
- Relationships: Foreign key to users table

#### **Audit Logs Table**
- Complete system activity tracking
- Fields: id, user_id, event_type, description, ip_address, user_agent, status, timestamp
- Purpose: Security monitoring and compliance (seen in Manager UI)
- Tracks: logins, check-ins, check-outs, user changes, system events

#### **System Settings Table**
- Application configuration
- Fields: id, setting_key, setting_value, description, updated_by, updated_at
- Purpose: Configurable parameters (work hours target, auto-checkout time, etc.)

#### **System Alerts Table**
- Notification system
- Fields: id, alert_type, title, message, is_active, created_at, expires_at
- Purpose: Display system-wide alerts (seen in Manager Dashboard)

---

## üèóÔ∏è PHASE 2: PROJECT STRUCTURE

```
timetracker-backend/
‚îú‚îÄ‚îÄ .env                          # Environment variables (secrets, config)
‚îú‚îÄ‚îÄ .gitignore                    # Git ignore file
‚îú‚îÄ‚îÄ package.json                  # Dependencies and scripts
‚îú‚îÄ‚îÄ server.js                     # Main entry point
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ timetracker.db           # SQLite database file
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js          # Database connection and initialization
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.js   # JWT verification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.middleware.js  # Input validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.middleware.js  # Error handling
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.js   # Login, register, logout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.controller.js # Student-specific operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.controller.js # Manager-specific operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ attendance.controller.js # Check-in/out logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report.controller.js  # Report generation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.controller.js    # User CRUD operations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audit.controller.js   # Audit log operations
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js       # Authentication endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.routes.js    # Student portal endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.routes.js    # Manager portal endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ attendance.routes.js # Attendance endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report.routes.js     # Report endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.routes.js       # User management endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audit.routes.js      # Audit log endpoints
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.model.js        # User database operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ attendance.model.js  # Attendance database operations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audit.model.js       # Audit log operations
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ jwt.util.js          # JWT token generation/verification
‚îÇ       ‚îú‚îÄ‚îÄ date.util.js         # Date/time calculations
‚îÇ       ‚îú‚îÄ‚îÄ validation.util.js   # Custom validators
‚îÇ       ‚îî‚îÄ‚îÄ cronjob.util.js      # Auto-checkout scheduler
```

---

## üîê PHASE 3: AUTHENTICATION SYSTEM

### **3.1 User Registration Flow**
1. Accept: student_id, name, email, password, role, department
2. Validate input (email format, password strength)
3. Check for duplicates (email, student_id)
4. Hash password with bcrypt
5. Insert into database
6. Create audit log entry
7. Return success (no auto-login)

### **3.2 Login Flow**
1. Accept: email, password
2. Find user by email
3. Verify password with bcrypt
4. Check account status (active/inactive)
5. Generate JWT token (payload: userId, email, role)
6. Update last_active timestamp
7. Create audit log entry
8. Return token + user info

### **3.3 JWT Token Structure**
- **Payload:** userId, email, role, issued_at
- **Expiration:** 24 hours (configurable)
- **Verification:** Middleware checks token on protected routes

### **3.4 Role-Based Access Control (RBAC)**
- **Student role:** Access to student portal only
- **Manager role:** Access to both portals + admin features
- Middleware: `authorize(['student'])` or `authorize(['manager'])`

---

## üë®‚Äçüéì PHASE 4: STUDENT PORTAL FEATURES

### **4.1 Dashboard **
**Endpoints:**
- `GET /api/student/dashboard` - Current status and today's hours
  - Returns: check-in status, today's hours, last check-in/out, weekly stats

### **4.2 Check-In Functionality **
**Endpoints:**
- `POST /api/attendance/check-in` - Start work session
  - Validate: No active session exists
  - Create: New attendance record with check_in_time
  - Update: Session status to 'active'
  - Log: Audit entry
  - Return: Confirmation + session details

### **4.3 Check-Out Functionality **
**Endpoints:**
- `POST /api/attendance/check-out` - End work session
  - Validate: Active session exists
  - Update: check_out_time, calculate total_hours
  - Update: Status to 'completed'
  - Log: Audit entry
  - Return: Session summary with total hours

### **4.4 Attendance History **
**Endpoints:**
- `GET /api/student/attendance/history` - Past attendance records
  - Query params: start_date, end_date, status, page, limit
  - Calculate: Total days, total hours, average daily, attendance rate
  - Return: Paginated list with filters

### **4.5 Personal Reports **
**Endpoints:**
- `GET /api/student/reports/summary` - Monthly/weekly summary
  - Calculate: Total hours, days present, average daily hours
  - Return: Summary statistics with trend data

---

## üë®‚Äçüíº PHASE 5: MANAGER PORTAL FEATURES

### **5.1 Manager Dashboard **
**Endpoints:**
- `GET /api/manager/dashboard` - Overview statistics
  - Returns:
    - Total students registered
    - Present today (count + percentage)
    - Absent today (count + percentage)
    - Average hours today
    - Weekly attendance trend (chart data)
    - Recent check-ins (last 10)
    - System alerts

### **5.2 User Management **
**Endpoints:**
- `GET /api/users` - List all users with filters
  - Query params: role, status, search, sort, page, limit
  - Returns: Paginated user list

- `POST /api/users` - Create new user (student/manager)
  - Validate: All required fields, unique email/student_id
  - Hash password
  - Create user record
  - Return: Created user info

- `GET /api/users/:id` - Get single user details
  - Returns: Full user profile + recent activity

- `PUT /api/users/:id` - Update user information
  - Allow: name, email, role, status, department
  - Validate: No duplicate email/student_id
  - Log: Audit entry with changes
  - Return: Updated user info

- `DELETE /api/users/:id` - Deactivate user account
  - Soft delete: Set status to 'inactive'
  - Log: Audit entry
  - Return: Success message

### **5.3 Attendance Reports **
**Endpoints:**
- `GET /api/manager/reports/daily` - Daily attendance report
  - Query params: date, min_hours, status, export_format
  - Returns: All students with check-in/out times, total hours, status
  - Support: Excel/PDF export

- `GET /api/manager/reports/student/:id` - Individual student report 
  - Query params: from_date, to_date, session_type
  - Calculate: Total hours, days present, average daily, auto-checkouts
  - Return: Detailed attendance history with trends

- `GET /api/manager/reports/weekly-trend` - Week-over-week comparison
  - Returns: Present vs absent counts per day
  - Format: Chart-ready data

### **5.4 Audit Logs **
**Endpoints:**
- `GET /api/audit/logs` - System activity logs
  - Query params: date_range, event_type, user, search, page, limit
  - Returns: Paginated audit entries
  - Events: Login, check-in, check-out, user updates, system changes

- `GET /api/audit/stats` - Audit statistics
  - Returns: Total events today, login events, attendance events, user changes

### **5.5 System Settings**
**Endpoints:**
- `GET /api/settings` - Get all settings
- `PUT /api/settings` - Update settings
  - Settings: default_work_hours, auto_checkout_time, etc.

---

## ‚öôÔ∏è PHASE 6: BUSINESS LOGIC & UTILITIES

### **6.1 Auto-Checkout System**
**Purpose:** Automatically check out students who forgot to check out

**Implementation:**
- Cron job runs at midnight (configurable)
- Find all attendance records with status='active'
- Update check_out_time to 11:59 PM same day
- Calculate total_hours
- Update status to 'auto_checkout'
- Create audit log entries
- Optional: Send notification/alert

### **6.2 Time Calculations**
**Functions:**
- `calculateTotalHours(checkIn, checkOut)` - Duration in hours
- `getWeeklyStats(userId, weekStart)` - Weekly aggregation
- `getMonthlyStats(userId, month, year)` - Monthly aggregation
- `calculateAttendanceRate(userId, startDate, endDate)` - Percentage

### **6.3 Data Validation**
**Rules:**
- Check-in: Cannot check in if already checked in
- Check-out: Cannot check out without active session
- Session duration: Alert if > 12 hours (possible forgot to check out)
- Date validation: All dates must be valid and not future dates

### **6.4 Report Generation**
**Export Formats:**
- JSON (default API response)
- Excel (for data analysis)
- PDF (for formal reports)

---

## üîí PHASE 7: SECURITY & BEST PRACTICES

### **7.1 Security Measures**
- **Password:** bcrypt hashing with salt rounds (10-12)
- **JWT:** Signed tokens with expiration
- **Input Validation:** express-validator on all inputs
- **SQL Injection:** Parameterized queries (no string concatenation)
- **CORS:** Configured for specific frontend origin
- **Rate Limiting:** Prevent brute force attacks (future enhancement)
- **Helmet:** Security HTTP headers

### **7.2 Error Handling**
- Centralized error middleware
- Consistent error response format
- Appropriate HTTP status codes
- No sensitive info in error messages (production)

### **7.3 Logging**
- Morgan for HTTP request logging
- Audit logs for security events
- Console logs for development
- File logs for production (future enhancement)

---

## üì° PHASE 8: API ENDPOINT SUMMARY

### **Authentication Endpoints**
```
POST   /api/auth/register      - Register new user
POST   /api/auth/login         - Login user
GET    /api/auth/me            - Get current user
POST   /api/auth/logout        - Logout user
```

### **Student Portal Endpoints**
```
GET    /api/student/dashboard           - Student dashboard
POST   /api/attendance/check-in         - Check in
POST   /api/attendance/check-out        - Check out
GET    /api/student/attendance/history  - Attendance history
GET    /api/student/reports/summary     - Personal reports
```

### **Manager Portal Endpoints**
```
GET    /api/manager/dashboard               - Manager dashboard
GET    /api/users                           - List users
POST   /api/users                           - Create user
GET    /api/users/:id                       - Get user
PUT    /api/users/:id                       - Update user
DELETE /api/users/:id                       - Delete user
GET    /api/manager/reports/daily           - Daily report
GET    /api/manager/reports/student/:id     - Student report
GET    /api/audit/logs                      - Audit logs
GET    /api/settings                        - Get settings
PUT    /api/settings                        - Update settings
```

---

## üß™ PHASE 9: TESTING STRATEGY

### **9.1 Manual Testing**
- Use Postman/Insomnia for API testing
- Test all CRUD operations
- Test authentication flow
- Test role-based access

### **9.2 Test Data**
- Create sample students and managers
- Generate test attendance records
- Test edge cases (same-day multiple check-ins, forgot check-out)

---

## üöÄ PHASE 10: DEVELOPMENT WORKFLOW

### **10.1 Development Order**
1. ‚úÖ Setup project structure and dependencies
2. ‚úÖ Initialize SQLite database with tables
3. ‚úÖ Create Express server with middleware
4. ‚úÖ Implement authentication system (in progress)
5. Implement student portal features
6. Implement manager portal features
7. Add business logic (auto-checkout, calculations)
8. Implement reporting system
9. Add audit logging everywhere
10. Testing and bug fixes
11. Documentation

### **10.2 Git Workflow**
- Initial commit with project structure
- Feature branches for each major component
- Commit frequently with clear messages
- Keep .env out of version control

---

## üì¶ PHASE 11: DEPLOYMENT CONSIDERATIONS (Future)

### **11.1 Environment Setup**
- Development (.env.development)
- Production (.env.production)
- Environment-specific configurations

### **11.2 Database Management**
- Database backup strategy
- Migration system for schema changes
- Seed data for testing

---

## üéØ CURRENT PROGRESS

‚úÖ **Completed:**
1. Project initialized with dependencies
2. Database schema designed and created
3. Express server setup with middleware
4. Authentication middleware created
5. Auth controller with register/login logic
6. Auth routes with validation

üìù **Next Steps:**
1. Integrate auth routes into server
2. Test authentication endpoints
3. Build student portal controllers
4. Build manager portal controllers
5. Implement attendance logic
6. Add reporting system

---

This plan provides a complete roadmap for building the TimeTracker backend system. Each phase builds on the previous one, and the detailed breakdown ensures we don't miss any features visible in the UI screenshots. 

Would you like me to continue implementing the remaining components, or would you like to review and modify this plan first?
